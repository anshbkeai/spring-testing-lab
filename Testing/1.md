Absolutely ‚Äî here‚Äôs a **real-production-style JIRA ticket**, written exactly the way companies write internal backend tasks.
No ‚Äútutorial tone,‚Äù no teaching voice.
Just straight-up **enterprise JIRA** ‚Äî crisp, formal, detailed, and meant for engineers in a real sprint.

This ticket is written as if it were assigned to a junior backend developer working on a large-scale social app's backend service.

---

# üßæ **JIRA Ticket ‚Äî PROD-3421**

**Title:** Add Unit Test Coverage for `PostService` (User Summary Aggregation + Post Fetch)

**Type:** Story
**Priority:** P2
**Component:** User Engagement Service
**Sprint:** SPRINT-48
**Reporter:** Lead Engineer ‚Äì Feed & Engagement
**Assignee:** *You*

---

## **Business Context**

The User Engagement team is preparing for the Q4 release.
As part of the Reliability Initiative, all core services must reach **85% code coverage** before feature freeze.

`PostService` currently has **0%** test coverage and is considered *critical path* because:

* The `/users/summary` endpoint feeds the weekly digest emails.
* The `/users/{id}/posts` endpoint is used by the frontend dashboard and 3 partner integrations.
* Recent production incidents revealed multiple silent null-list issues due to missing test coverage.

This ticket ensures correctness, safety, and consistent behavior across deployments.

---

## **Scope**

Unit tests need to be added for:

### **1. `summary()`**

This method performs a per-user aggregation of:

* Latest post
* Post count
* Summary DTO creation

Test the following functional scenarios:

#### **1.1 Users with posts**

* `userRepository.findAll()` returns non-empty list
* Latest post exists for each user
* Ensure DTO fields (`postCount`, `latestPostTitle`, `postCreatedAt`) are populated correctly
* Validate that repository calls occur per user

#### **1.2 Users without posts**

* Latest post returns `Optional.empty()`
* `latestPostTitle` and `postCreatedAt` must be `null`
* No exceptions thrown

#### **1.3 No users**

* Empty list case
* No calls to `postRepository` should occur

---

### **2. `getPostByUser(int userId)`**

#### **2.1 Valid user**

* Verify `findById()` + `findByUser()` invocation chain
* Validate returned post list

#### **2.2 Invalid user**

* `findById()` returns `Optional.empty()`
* The current implementation calls `.get()`, so a `NoSuchElementException` should be propagated
* Ensure `postRepository.findByUser()` is not triggered

---

## **Non-Functional Requirements**

* All tests must use **JUnit 5** + **Mockito**
* Use `@ExtendWith(MockitoExtension.class)`
* Test class name must follow pattern: `PostServiceTest`
* Code coverage increase required: **‚â• 85% for PostService**
* Tests should not make real DB calls
* Follow existing testing conventions under `/src/test/java/...`

---

## **Acceptance Criteria**

| AC # | Description                                                  | Status |
| ---- | ------------------------------------------------------------ | ------ |
| AC-1 | Unit tests implemented for all scenarios listed above        | ‚òê      |
| AC-2 | Repository calls are verified with correct invocation counts | ‚òê      |
| AC-3 | Null-safe and empty-state behaviors validated                | ‚òê      |
| AC-4 | Exceptions correctly propagated                              | ‚òê      |
| AC-5 | Code coverage ‚â• 85% for `PostService`                        | ‚òê      |
| AC-6 | Build pipeline successfully passes (`mvn test`)              | ‚òê      |

---

## **Out of Scope**

* Integration tests
* Refactoring service logic
* Testcontainers or DB-backed testing
* Controller-layer test coverage

---

## **Technical Notes**

* Follow mocking patterns used in `UserServiceTest` (existing tests in codebase)
* Mock data builders available under `com.sql.dbms.testutils` may be reused
* DTO comparison should not use deep equals; validate fields individually

---

## **Dependencies**

* No external dependencies
* Must be completed before PROD-3414 (Enable coverage gate in CI)

---

## **Definition of Done**

* PR raised with tests + coverage screenshot
* Code reviewed by any senior engineer in engagement team
* All ACs met
* Branch rebased on latest `develop`

---

This is the kind of ticket that appears in enterprise JIRA on a real backend team ‚Äî no fluff, no learning language, just production-grade engineering expectations.

---


